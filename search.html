<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <title>Campus Resource</title>
</head>

<body>
    <header>
        <h2>Campus Resource</h2>
    </header>
    
    <nav class="navbar">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="browse-resources.html">Browse Resources</a></li>
            <li><a href="booking.html">My Booking</a></li>
            <li><a href="profile.html">Profile</a></li>
            <li><a href="login.html">Login/Logout</a></li>
            <li>
                <div class="nav-search">
                  <form id="navSearchForm" action="search.html" method="GET">
  <input id="navSearchInput" name="q" type="search" placeholder="Search…" />
  <button type="submit">Search</button>
                  </form>
                </div>
          </li>
        </ul>
    </nav>
<
  <main class="container">
    <h1>Search Results</h1>
    <p id="queryText" class="muted"></p>
    <div id="results"></div>
  </main>
  <footer>
      <h3 class="Emergency">  Emergency: <a href="tel:514-848-3717" style="font-weight: 200;">514-848-3717</a> |  Central: <a href="tel:514-848-2424" style="font-weight: 200;"> 514-848-2424</a></h3>
      <br>
      <div class="hours-info">
      <h3 class="hours-title">Open Hours: <span class="hours-time" style="font-weight: 200;">10:00 AM – 9:00 PM Everyday</span></h3>
    <br>
    <h3 class="contact"> Contact: <a href="email:info@campusresource.edu" style="font-weight: 200;"> info@campusresource.edu</a></h3>
   </div>
<br>
<br>
<hr>
        <p>&copy; 2025-2026 Campus Resource Booking. All rights reserved.</p>
        
    </footer>

  <script>
    // --- helpers ---
    function getParam(name){
      const p = new URLSearchParams(location.search).get(name);
      return p ? p.trim() : "";
    }
    function escapeRegExp(str){return str.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");}
    function highlight(text, q){
      const rx = new RegExp(escapeRegExp(q), "gi");
      return text.replace(rx, m => `<mark>${m}</mark>`);
    }
    // basit skor: title tam eşleşme +5, başlıkta geçiş +3, gövdede her geçiş +1
    function scoreDoc(doc, q){
      const qlc = q.toLowerCase();
      const title = (doc.title||"").toLowerCase();
      const body  = (doc.content||"").toLowerCase();
      let s = 0;
      if(title === qlc) s += 5;
      if(title.includes(qlc)) s += 3;
      const count = (body.match(new RegExp(escapeRegExp(qlc), "g"))||[]).length;
      s += count;
      return s;
    }
    // kısa snippet çıkar
    function snippet(text, q){
      const idx = text.toLowerCase().indexOf(q.toLowerCase());
      if(idx === -1) return text.slice(0,140) + (text.length>140 ? "..." : "");
      const start = Math.max(0, idx - 60);
      const end   = Math.min(text.length, idx + q.length + 60);
      return ( (start>0?"...":"") + text.slice(start, end) + (end<text.length?"...":"") );
    }

    (async function(){
      const q = getParam("q");
      const resultsEl = document.getElementById("results");
      const queryText = document.getElementById("queryText");
      queryText.textContent = q ? `Query: "${q}"` : "No query";

      if(!q){
        resultsEl.innerHTML = "<p>Please enter a search term.</p>";
        return;
      }

      // siteIndex.json aynı dizinde olmalı
      let index = [];
      try{
        const res = await fetch("siteIndex.json", {cache:"no-store"});
        index = await res.json();
      }catch(e){
        resultsEl.innerHTML = "<p>Could not load index.</p>";
        return;
      }

      // filtrele, skorla, sırala
      const filtered = index
        .map(doc => ({...doc, _score: scoreDoc(doc, q)}))
        .filter(d => d._score > 0);

      if(filtered.length === 0){
        resultsEl.innerHTML = "<p>No results found.</p>";
        return;
      }

      filtered.sort((a,b)=> b._score - a._score);

      // render
      resultsEl.innerHTML = "";
      filtered.forEach(doc=>{
        const snip = snippet(doc.content, q);
        const div = document.createElement("div");
        div.className = "result";
        div.innerHTML = `
          <a href="${doc.url}">${highlight(doc.title, q)}</a>
          <div class="muted">${doc.url} • score ${doc._score}</div>
          <p>${highlight(snip, q)}</p>
        `;
        resultsEl.appendChild(div);
      });
    })();
  </script>
  <script src="js/navbar.js"></script>
</body>
</html>
